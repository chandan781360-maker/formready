{% extends "base.html" %}
{% block content %}
<title>PDF → Image</title>

<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

<style>
.page-card {
    background: #fff;
    width: 520px;
    margin: 80px auto;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    text-align: center;
}

.upload-btn {
    padding: 12px;
    width: 100%;
    font-size: 15px;
    cursor: pointer;
}

.options {
    margin: 15px 0;
    font-size: 14px;
}

.preview-list {
    margin-top: 25px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 14px;
}

.preview-item {
    border: 1px solid #ddd;
    border-radius: 6px;
    padding: 8px;
    background: #fafafa;
}

.preview-item img {
    width: 100%;
    border-radius: 4px;
}

.download-btn {
    margin-top: 6px;
    display: inline-block;
    padding: 6px 10px;
    font-size: 13px;
    background: #2f80ed;
    color: #fff;
    border-radius: 4px;
    text-decoration: none;
}

.download-btn:hover {
    background: #256ad1;
}

.zip-btn {
    margin-top: 15px;
    display: none;
    padding: 10px 14px;
    background: #27ae60;
    color: #fff;
    border-radius: 6px;
    text-decoration: none;
    font-size: 14px;
}

.back-link {
    display: inline-block;
    margin-top: 25px;
}
</style>
</head>

<body>

<div class="page-card">
    <h2>PDF → Image</h2>
    <p>Select a PDF file to convert each page into images.</p>

    <button class="upload-btn" onclick="pdfInput.click()">
        Upload PDF
    </button>

    <input type="file" id="pdfInput" accept="application/pdf" hidden>

    <div class="options">
        Output format:
        <select id="format">
            <option value="jpg">JPG</option>
            <option value="png">PNG</option>
        </select>
    </div>

    <a id="zipDownload" class="zip-btn">⬇ Download All Images (ZIP)</a>

    <div id="preview" class="preview-list"></div>

    <a class="back-link" href="/">← Back</a>
</div>

<script>
const pdfInput = document.getElementById("pdfInput");
pdfInput.addEventListener("change", () => convertPdf());

async function convertPdf() {
    if (!pdfInput.files.length) return;

    const format = document.getElementById("format").value;
    const preview = document.getElementById("preview");
    preview.innerHTML = "Processing…";

    // ---------- PREVIEW ----------
    const fd = new FormData();
    fd.append("file", pdfInput.files[0]);

    const res = await fetch("/pdf-to-images", {
        method: "POST",
        body: fd
    });

    const data = await res.json();
    preview.innerHTML = "";

    data.images.forEach((url, index) => {
        const box = document.createElement("div");
        box.className = "preview-item";

        const img = document.createElement("img");
        img.src = url;

        const link = document.createElement("a");
        link.href = url;
        link.download = `page-${index + 1}.jpg`;
        link.className = "download-btn";
        link.innerText = "Download";

        box.appendChild(img);
        box.appendChild(link);
        preview.appendChild(box);
    });

    // ---------- ZIP ----------
    const fdZip = new FormData();
    fdZip.append("file", pdfInput.files[0]);
    fdZip.append("format", format);

    const zipRes = await fetch("/pdf-to-images-zip", {
        method: "POST",
        body: fdZip
    });

    const zipData = await zipRes.json();
    const zipBtn = document.getElementById("zipDownload");
    zipBtn.href = zipData.zip_url;
    zipBtn.style.display = "inline-block";
}
</script>

{% endblock %}
